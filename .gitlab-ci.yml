# .gitlab-ci.yml

image: node:20

stages:
  - install
  - lint
  - build

before_script:
  - npm install -g pnpm@latest # 强制使用最新版 pnpm（可选但推荐）
  # 如果不想升级，也可以不加 @latest，但需确保项目兼容

install_dependencies:
  stage: install
  script:
    - pnpm install --frozen-lockfile # 替代 pnpm ci
  cache:
    key: $ {CI_COMMIT_REF_SLUG}
    paths:
      - .pnpm/ # pnpm v7+ 默认 store 目录（如果没自定义）
  artifacts:
    paths:
      - node_modules/

lint_app:
  stage: lint
  script:
    - pnpm run lint:fix
    - pnpm run format

build_app:
  stage: build
  script:
    - pnpm run build
  artifacts:
    paths:
      - dist/
